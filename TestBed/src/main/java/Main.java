import Blacklist.BlackListExecution;
import Helpers.AuxFunctions;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import org.apache.tuweni.bytes.Bytes;

import org.apache.tuweni.units.bigints.UInt256;
import org.hyperledger.besu.datatypes.Address;
import org.hyperledger.besu.datatypes.Wei;
import org.hyperledger.besu.ethereum.core.MutableWorldState;
import org.hyperledger.besu.evm.*;
import org.hyperledger.besu.evm.account.MutableAccount;
import org.hyperledger.besu.evm.fluent.EVMExecutor;
import org.hyperledger.besu.evm.fluent.SimpleWorld;
import org.hyperledger.besu.evm.frame.MessageFrame;
import org.hyperledger.besu.evm.tracing.StandardJsonTracer;
import org.web3j.crypto.Hash;
import org.web3j.utils.Numeric;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;
import java.math.BigInteger;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.Base64;

import static Helpers.AuxFunctions.extractAddressFromReturnData;

public class Main {

    public static void main(String[] args) {
        System.setProperty("jna.nosys", "true");
        System.setProperty("besu.disable-native", "true");

//        BlackListExecution exec = new BlackListExecution();
//        exec.Execute();

        // Function Selectors

        // BlackList Function Selectors
        String addToBlacklistFunctionSelector = AuxFunctions.getFunctionSelector("addToBlacklist(address)");
        String removeFromBlacklistFunctionSelector = AuxFunctions.getFunctionSelector("removeFromBlacklist(address)");
        String isBlackListedFunctionSelector = AuxFunctions.getFunctionSelector("isBlacklisted(address)");

        // IstCoin Function Selectors
        String myBalanceFunctionSelector = AuxFunctions.getFunctionSelector("myBalance()");

//        String transferFunctionSelector = AuxFunctions.getFunctionSelector("transfer(address,address,uint256)");
        String transferFunctionSelector = AuxFunctions.getFunctionSelector("transferFrom(address,address,uint256)");

        // Accounts
        String owner = "0x78731D3Ca6b7E34aC0F824c42a7cC18A495cabaB";
        String blackList = "0x5B38Da6a701c568545dCfcB03FcB875f56beddC4";
        String dudeToBlackList = "0x17F6AD8Ef982297579C203069C1DbfFE4348c372";
        String IstCoin = "0xCA35b7d915458EF540aDe6068dFe2F44E8fa733c";
        String randomDude = "0x4B0897b0513fdC7C541B6d9D7E929C4e5364D2dB";

        // World Creation
        SimpleWorld blockChain = new SimpleWorld();

        // Address creation
        Address ownerAddress = Address.fromHexString(owner);
        Address blackListContractAddress = Address.fromHexString(blackList);
        Address dudeGettingBlackListedAddress = Address.fromHexString(dudeToBlackList);
        Address IstCoinAddress = Address.fromHexString(IstCoin);
        Address randomDudeAddress = Address.fromHexString(randomDude);

        // Account creation
        blockChain.createAccount(ownerAddress, 0, Wei.fromEth(199));
        blockChain.createAccount(dudeGettingBlackListedAddress, 0, Wei.fromEth(10));
        blockChain.createAccount(blackListContractAddress, 0, Wei.fromEth(0));
        blockChain.createAccount(IstCoinAddress, 0, Wei.fromEth(1000));
        blockChain.createAccount(randomDudeAddress, 0, Wei.fromEth(1000));

        // Accounts fetched as Mutable accounts
        MutableAccount ownerAccount = (MutableAccount) blockChain.get(ownerAddress);
        MutableAccount blackListContractAccount = (MutableAccount) blockChain.get(blackListContractAddress);
        MutableAccount blacklistedDudeAccount = (MutableAccount) blockChain.get(dudeGettingBlackListedAddress);
        MutableAccount IstCoinContractAccount = (MutableAccount) blockChain.get(IstCoinAddress);
        MutableAccount RandomDudeAccount = (MutableAccount) blockChain.get(IstCoinAddress);

        // Contract codes
        String blackListContractDeployCode = "608060405234801561000f575f80fd5b50604051610a79380380610a79833981810160405281019061003191906101d7565b805f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036100a2575f6040517f1e4fbdf70000000000000000000000000000000000000000000000000000000081526004016100999190610211565b60405180910390fd5b6100b1816100b860201b60201c565b505061022a565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050815f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6101a68261017d565b9050919050565b6101b68161019c565b81146101c0575f80fd5b50565b5f815190506101d1816101ad565b92915050565b5f602082840312156101ec576101eb610179565b5b5f6101f9848285016101c3565b91505092915050565b61020b8161019c565b82525050565b5f6020820190506102245f830184610202565b92915050565b610842806102375f395ff3fe608060405234801561000f575f80fd5b5060043610610060575f3560e01c806344337ea114610064578063537df3b614610094578063715018a6146100c45780638da5cb5b146100ce578063f2fde38b146100ec578063fe575a8714610108575b5f80fd5b61007e6004803603810190610079919061065a565b610138565b60405161008b919061069f565b60405180910390f35b6100ae60048036038101906100a9919061065a565b61026b565b6040516100bb919061069f565b60405180910390f35b6100cc61039d565b005b6100d66103b0565b6040516100e391906106c7565b60405180910390f35b6101066004803603810190610101919061065a565b6103d7565b005b610122600480360381019061011d919061065a565b61045b565b60405161012f919061069f565b60405180910390f35b5f6101416104ad565b60015f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16156101cb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101c290610760565b60405180910390fd5b6001805f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167ff9b68063b051b82957fa193585681240904fed808db8b30fc5a2d2202c6ed62760405160405180910390a260019050919050565b5f6102746104ad565b60015f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166102fd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102f4906107ee565b60405180910390fd5b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f2b6bf71b58b3583add364b3d9060ebf8019650f65f5be35f5464b9cb3e4ba2d460405160405180910390a260019050919050565b6103a56104ad565b6103ae5f610534565b565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6103df6104ad565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361044f575f6040517f1e4fbdf700000000000000000000000000000000000000000000000000000000815260040161044691906106c7565b60405180910390fd5b61045881610534565b50565b5f60015f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff169050919050565b6104b56105f5565b73ffffffffffffffffffffffffffffffffffffffff166104d36103b0565b73ffffffffffffffffffffffffffffffffffffffff1614610532576104f66105f5565b6040517f118cdaa700000000000000000000000000000000000000000000000000000000815260040161052991906106c7565b60405180910390fd5b565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050815f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f33905090565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61062982610600565b9050919050565b6106398161061f565b8114610643575f80fd5b50565b5f8135905061065481610630565b92915050565b5f6020828403121561066f5761066e6105fc565b5b5f61067c84828501610646565b91505092915050565b5f8115159050919050565b61069981610685565b82525050565b5f6020820190506106b25f830184610690565b92915050565b6106c18161061f565b82525050565b5f6020820190506106da5f8301846106b8565b92915050565b5f82825260208201905092915050565b7f426c61636b6c6973743a204164647265737320616c726561647920626c61636b5f8201527f6c69737465640000000000000000000000000000000000000000000000000000602082015250565b5f61074a6026836106e0565b9150610755826106f0565b604082019050919050565b5f6020820190508181035f8301526107778161073e565b9050919050565b7f426c61636b6c6973743a2041646472657373206e6f7420626c61636b6c6973745f8201527f6564000000000000000000000000000000000000000000000000000000000000602082015250565b5f6107d86022836106e0565b91506107e38261077e565b604082019050919050565b5f6020820190508181035f830152610805816107cc565b905091905056fea26469706673582212207288229610da2ede2f296b02ae934dd3f92f6a15d5d42fe757b52f6c469e9d9a64736f6c634300081a0033";
        String blackListContractRuntimeCode = "608060405234801561000f575f80fd5b5060043610610060575f3560e01c806344337ea114610064578063537df3b614610094578063715018a6146100c45780638da5cb5b146100ce578063f2fde38b146100ec578063fe575a8714610108575b5f80fd5b61007e6004803603810190610079919061065a565b610138565b60405161008b919061069f565b60405180910390f35b6100ae60048036038101906100a9919061065a565b61026b565b6040516100bb919061069f565b60405180910390f35b6100cc61039d565b005b6100d66103b0565b6040516100e391906106c7565b60405180910390f35b6101066004803603810190610101919061065a565b6103d7565b005b610122600480360381019061011d919061065a565b61045b565b60405161012f919061069f565b60405180910390f35b5f6101416104ad565b60015f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16156101cb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101c290610760565b60405180910390fd5b6001805f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167ff9b68063b051b82957fa193585681240904fed808db8b30fc5a2d2202c6ed62760405160405180910390a260019050919050565b5f6102746104ad565b60015f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166102fd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102f4906107ee565b60405180910390fd5b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f2b6bf71b58b3583add364b3d9060ebf8019650f65f5be35f5464b9cb3e4ba2d460405160405180910390a260019050919050565b6103a56104ad565b6103ae5f610534565b565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6103df6104ad565b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361044f575f6040517f1e4fbdf700000000000000000000000000000000000000000000000000000000815260040161044691906106c7565b60405180910390fd5b61045881610534565b50565b5f60015f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff169050919050565b6104b56105f5565b73ffffffffffffffffffffffffffffffffffffffff166104d36103b0565b73ffffffffffffffffffffffffffffffffffffffff1614610532576104f66105f5565b6040517f118cdaa700000000000000000000000000000000000000000000000000000000815260040161052991906106c7565b60405180910390fd5b565b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050815f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b5f33905090565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61062982610600565b9050919050565b6106398161061f565b8114610643575f80fd5b50565b5f8135905061065481610630565b92915050565b5f6020828403121561066f5761066e6105fc565b5b5f61067c84828501610646565b91505092915050565b5f8115159050919050565b61069981610685565b82525050565b5f6020820190506106b25f830184610690565b92915050565b6106c18161061f565b82525050565b5f6020820190506106da5f8301846106b8565b92915050565b5f82825260208201905092915050565b7f426c61636b6c6973743a204164647265737320616c726561647920626c61636b5f8201527f6c69737465640000000000000000000000000000000000000000000000000000602082015250565b5f61074a6026836106e0565b9150610755826106f0565b604082019050919050565b5f6020820190508181035f8301526107778161073e565b9050919050565b7f426c61636b6c6973743a2041646472657373206e6f7420626c61636b6c6973745f8201527f6564000000000000000000000000000000000000000000000000000000000000602082015250565b5f6107d86022836106e0565b91506107e38261077e565b604082019050919050565b5f6020820190508181035f830152610805816107cc565b905091905056fea26469706673582212207288229610da2ede2f296b02ae934dd3f92f6a15d5d42fe757b52f6c469e9d9a64736f6c634300081a0033";
        String IstCoinContractDeployCode = "60806040525f600560146101000a81548160ff021916908315150217905550348015610029575f80fd5b50604051611d5a380380611d5a833981810160405281019061004b9190610447565b6040518060400160405280600881526020017f49535420436f696e0000000000000000000000000000000000000000000000008152506040518060400160405280600381526020017f495354000000000000000000000000000000000000000000000000000000000081525081600390816100c691906106bf565b5080600490816100d691906106bf565b5050508160055f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061012e816402540be40061013560201b60201c565b5050610873565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036101a5575f6040517fec442f0500000000000000000000000000000000000000000000000000000000815260040161019c919061079d565b60405180910390fd5b6101b65f83836101ba60201b60201c565b5050565b6101cb8383836101d060201b60201c565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610220578060025f82825461021491906107e3565b925050819055506102ee565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050818110156102a9578381836040517fe450d38c0000000000000000000000000000000000000000000000000000000081526004016102a093929190610825565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610335578060025f828254039250508190555061037f565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516103dc919061085a565b60405180910390a3505050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610416826103ed565b9050919050565b6104268161040c565b8114610430575f80fd5b50565b5f815190506104418161041d565b92915050565b5f806040838503121561045d5761045c6103e9565b5b5f61046a85828601610433565b925050602061047b85828601610433565b9150509250929050565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061050057607f821691505b602082108103610513576105126104bc565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026105757fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261053a565b61057f868361053a565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f6105c36105be6105b984610597565b6105a0565b610597565b9050919050565b5f819050919050565b6105dc836105a9565b6105f06105e8826105ca565b848454610546565b825550505050565b5f90565b6106046105f8565b61060f8184846105d3565b505050565b5b81811015610632576106275f826105fc565b600181019050610615565b5050565b601f8211156106775761064881610519565b6106518461052b565b81016020851015610660578190505b61067461066c8561052b565b830182610614565b50505b505050565b5f82821c905092915050565b5f6106975f198460080261067c565b1980831691505092915050565b5f6106af8383610688565b9150826002028217905092915050565b6106c882610485565b67ffffffffffffffff8111156106e1576106e061048f565b5b6106eb82546104e9565b6106f6828285610636565b5f60209050601f831160018114610727575f8415610715578287015190505b61071f85826106a4565b865550610786565b601f19841661073586610519565b5f5b8281101561075c57848901518255600182019150602085019450602081019050610737565b868310156107795784890151610775601f891682610688565b8355505b6001600288020188555050505b505050505050565b6107978161040c565b82525050565b5f6020820190506107b05f83018461078e565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6107ed82610597565b91506107f883610597565b92508282019050808211156108105761080f6107b6565b5b92915050565b61081f81610597565b82525050565b5f6060820190506108385f83018661078e565b6108456020830185610816565b6108526040830184610816565b949350505050565b5f60208201905061086d5f830184610816565b92915050565b6114da806108805f395ff3fe608060405234801561000f575f80fd5b50600436106100fe575f3560e01c806395d89b4111610095578063beabacc811610064578063beabacc8146102d6578063c75f1fba14610306578063c9116b6914610324578063dd62ed3e14610342576100fe565b806395d89b411461023a578063a457c2d714610258578063a4b5fa5614610288578063a9059cbb146102a6576100fe565b80632ff2e9dc116100d15780632ff2e9dc1461019e578063313ce567146101bc57806339509351146101da57806370a082311461020a576100fe565b806306fdde0314610102578063095ea7b31461012057806318160ddd1461015057806323b872dd1461016e575b5f80fd5b61010a610372565b6040516101179190610f06565b60405180910390f35b61013a60048036038101906101359190610fb7565b610402565b604051610147919061100f565b60405180910390f35b610158610464565b6040516101659190611037565b60405180910390f35b61018860048036038101906101839190611050565b61046d565b604051610195919061100f565b60405180910390f35b6101a661049b565b6040516101b39190611037565b60405180910390f35b6101c46104a4565b6040516101d191906110bb565b60405180910390f35b6101f460048036038101906101ef9190610fb7565b6104ac565b604051610201919061100f565b60405180910390f35b610224600480360381019061021f91906110d4565b6105bb565b6040516102319190611037565b60405180910390f35b610242610600565b60405161024f9190610f06565b60405180910390f35b610272600480360381019061026d9190610fb7565b610690565b60405161027f919061100f565b60405180910390f35b6102906107de565b60405161029d919061115a565b60405180910390f35b6102c060048036038101906102bb9190610fb7565b610803565b6040516102cd919061100f565b60405180910390f35b6102f060048036038101906102eb9190611050565b610825565b6040516102fd919061100f565b60405180910390f35b61030e61083c565b60405161031b919061100f565b60405180910390f35b61032c61084f565b6040516103399190611037565b60405180910390f35b61035c60048036038101906103579190611173565b61085e565b6040516103699190611037565b60405180910390f35b606060038054610381906111de565b80601f01602080910402602001604051908101604052809291908181526020018280546103ad906111de565b80156103f85780601f106103cf576101008083540402835291602001916103f8565b820191905f5260205f20905b8154815290600101906020018083116103db57829003601f168201915b5050505050905090565b5f600560149054906101000a900460ff16610452576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104499061127e565b60405180910390fd5b61045c83836108e0565b905092915050565b5f600254905090565b5f80610477610902565b9050610484858285610909565b61048f85858561099c565b60019150509392505050565b6402540be40081565b5f6002905090565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe575a87846040518263ffffffff1660e01b815260040161050791906112ab565b602060405180830381865afa158015610522573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061054691906112ee565b15610586576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161057d90611363565b60405180910390fd5b5f61058f610902565b90506105b08185856105a1858961085e565b6105ab91906113ae565b610a8c565b600191505092915050565b5f805f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b60606004805461060f906111de565b80601f016020809104026020016040519081016040528092919081815260200182805461063b906111de565b80156106865780601f1061065d57610100808354040283529160200191610686565b820191905f5260205f20905b81548152906001019060200180831161066957829003601f168201915b5050505050905090565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe575a87846040518263ffffffff1660e01b81526004016106eb91906112ab565b602060405180830381865afa158015610706573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061072a91906112ee565b1561076a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161076190611363565b60405180910390fd5b5f610773610902565b90505f610780828661085e565b9050838110156107c5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107bc90611451565b60405180910390fd5b6107d28286868403610a8c565b60019250505092915050565b60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b5f8061080d610902565b905061081a81858561099c565b600191505092915050565b5f610831848484610a9e565b600190509392505050565b600560149054906101000a900460ff1681565b5f610859336105bb565b905090565b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905092915050565b5f806108ea610902565b90506108f7818585610a8c565b600191505092915050565b5f33905090565b5f610914848461085e565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8110156109965781811015610987578281836040517ffb8f41b200000000000000000000000000000000000000000000000000000000815260040161097e9392919061146f565b60405180910390fd5b61099584848484035f610aae565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610a0c575f6040517f96c6fd1e000000000000000000000000000000000000000000000000000000008152600401610a0391906112ab565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610a7c575f6040517fec442f05000000000000000000000000000000000000000000000000000000008152600401610a7391906112ab565b60405180910390fd5b610a87838383610a9e565b505050565b610a998383836001610aae565b505050565b610aa9838383610c7d565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610b1e575f6040517fe602df05000000000000000000000000000000000000000000000000000000008152600401610b1591906112ab565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610b8e575f6040517f94280d62000000000000000000000000000000000000000000000000000000008152600401610b8591906112ab565b60405180910390fd5b8160015f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055508015610c77578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92584604051610c6e9190611037565b60405180910390a35b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610ccd578060025f828254610cc191906113ae565b92505081905550610d9b565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905081811015610d56578381836040517fe450d38c000000000000000000000000000000000000000000000000000000008152600401610d4d9392919061146f565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610de2578060025f8282540392505081905550610e2c565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610e899190611037565b60405180910390a3505050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f610ed882610e96565b610ee28185610ea0565b9350610ef2818560208601610eb0565b610efb81610ebe565b840191505092915050565b5f6020820190508181035f830152610f1e8184610ece565b905092915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610f5382610f2a565b9050919050565b610f6381610f49565b8114610f6d575f80fd5b50565b5f81359050610f7e81610f5a565b92915050565b5f819050919050565b610f9681610f84565b8114610fa0575f80fd5b50565b5f81359050610fb181610f8d565b92915050565b5f8060408385031215610fcd57610fcc610f26565b5b5f610fda85828601610f70565b9250506020610feb85828601610fa3565b9150509250929050565b5f8115159050919050565b61100981610ff5565b82525050565b5f6020820190506110225f830184611000565b92915050565b61103181610f84565b82525050565b5f60208201905061104a5f830184611028565b92915050565b5f805f6060848603121561106757611066610f26565b5b5f61107486828701610f70565b935050602061108586828701610f70565b925050604061109686828701610fa3565b9150509250925092565b5f60ff82169050919050565b6110b5816110a0565b82525050565b5f6020820190506110ce5f8301846110ac565b92915050565b5f602082840312156110e9576110e8610f26565b5b5f6110f684828501610f70565b91505092915050565b5f819050919050565b5f61112261111d61111884610f2a565b6110ff565b610f2a565b9050919050565b5f61113382611108565b9050919050565b5f61114482611129565b9050919050565b6111548161113a565b82525050565b5f60208201905061116d5f83018461114b565b92915050565b5f806040838503121561118957611188610f26565b5b5f61119685828601610f70565b92505060206111a785828601610f70565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806111f557607f821691505b602082108103611208576112076111b1565b5b50919050565b7f495354436f696e3a2044697265637420617070726f76652063616c6c732061725f8201527f652064697361626c656400000000000000000000000000000000000000000000602082015250565b5f611268602a83610ea0565b91506112738261120e565b604082019050919050565b5f6020820190508181035f8301526112958161125c565b9050919050565b6112a581610f49565b82525050565b5f6020820190506112be5f83018461129c565b92915050565b6112cd81610ff5565b81146112d7575f80fd5b50565b5f815190506112e8816112c4565b92915050565b5f6020828403121561130357611302610f26565b5b5f611310848285016112da565b91505092915050565b7f495354436f696e3a205370656e64657220697320626c61636b6c6973746564005f82015250565b5f61134d601f83610ea0565b915061135882611319565b602082019050919050565b5f6020820190508181035f83015261137a81611341565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6113b882610f84565b91506113c383610f84565b92508282019050808211156113db576113da611381565b5b92915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f775f8201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b5f61143b602583610ea0565b9150611446826113e1565b604082019050919050565b5f6020820190508181035f8301526114688161142f565b9050919050565b5f6060820190506114825f83018661129c565b61148f6020830185611028565b61149c6040830184611028565b94935050505056fea26469706673582212201fbb789a33d8c8c22ea3db17719c70c7a24c39862058fc3328c8af580b23b02c64736f6c634300081a0033";
        String IstCoinContractRuntimeCode = "608060405234801561000f575f80fd5b50600436106100fe575f3560e01c806395d89b4111610095578063beabacc811610064578063beabacc8146102d6578063c75f1fba14610306578063c9116b6914610324578063dd62ed3e14610342576100fe565b806395d89b411461023a578063a457c2d714610258578063a4b5fa5614610288578063a9059cbb146102a6576100fe565b80632ff2e9dc116100d15780632ff2e9dc1461019e578063313ce567146101bc57806339509351146101da57806370a082311461020a576100fe565b806306fdde0314610102578063095ea7b31461012057806318160ddd1461015057806323b872dd1461016e575b5f80fd5b61010a610372565b6040516101179190610f06565b60405180910390f35b61013a60048036038101906101359190610fb7565b610402565b604051610147919061100f565b60405180910390f35b610158610464565b6040516101659190611037565b60405180910390f35b61018860048036038101906101839190611050565b61046d565b604051610195919061100f565b60405180910390f35b6101a661049b565b6040516101b39190611037565b60405180910390f35b6101c46104a4565b6040516101d191906110bb565b60405180910390f35b6101f460048036038101906101ef9190610fb7565b6104ac565b604051610201919061100f565b60405180910390f35b610224600480360381019061021f91906110d4565b6105bb565b6040516102319190611037565b60405180910390f35b610242610600565b60405161024f9190610f06565b60405180910390f35b610272600480360381019061026d9190610fb7565b610690565b60405161027f919061100f565b60405180910390f35b6102906107de565b60405161029d919061115a565b60405180910390f35b6102c060048036038101906102bb9190610fb7565b610803565b6040516102cd919061100f565b60405180910390f35b6102f060048036038101906102eb9190611050565b610825565b6040516102fd919061100f565b60405180910390f35b61030e61083c565b60405161031b919061100f565b60405180910390f35b61032c61084f565b6040516103399190611037565b60405180910390f35b61035c60048036038101906103579190611173565b61085e565b6040516103699190611037565b60405180910390f35b606060038054610381906111de565b80601f01602080910402602001604051908101604052809291908181526020018280546103ad906111de565b80156103f85780601f106103cf576101008083540402835291602001916103f8565b820191905f5260205f20905b8154815290600101906020018083116103db57829003601f168201915b5050505050905090565b5f600560149054906101000a900460ff16610452576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104499061127e565b60405180910390fd5b61045c83836108e0565b905092915050565b5f600254905090565b5f80610477610902565b9050610484858285610909565b61048f85858561099c565b60019150509392505050565b6402540be40081565b5f6002905090565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe575a87846040518263ffffffff1660e01b815260040161050791906112ab565b602060405180830381865afa158015610522573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061054691906112ee565b15610586576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161057d90611363565b60405180910390fd5b5f61058f610902565b90506105b08185856105a1858961085e565b6105ab91906113ae565b610a8c565b600191505092915050565b5f805f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b60606004805461060f906111de565b80601f016020809104026020016040519081016040528092919081815260200182805461063b906111de565b80156106865780601f1061065d57610100808354040283529160200191610686565b820191905f5260205f20905b81548152906001019060200180831161066957829003601f168201915b5050505050905090565b5f60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fe575a87846040518263ffffffff1660e01b81526004016106eb91906112ab565b602060405180830381865afa158015610706573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061072a91906112ee565b1561076a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161076190611363565b60405180910390fd5b5f610773610902565b90505f610780828661085e565b9050838110156107c5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107bc90611451565b60405180910390fd5b6107d28286868403610a8c565b60019250505092915050565b60055f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b5f8061080d610902565b905061081a81858561099c565b600191505092915050565b5f610831848484610a9e565b600190509392505050565b600560149054906101000a900460ff1681565b5f610859336105bb565b905090565b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905092915050565b5f806108ea610902565b90506108f7818585610a8c565b600191505092915050565b5f33905090565b5f610914848461085e565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8110156109965781811015610987578281836040517ffb8f41b200000000000000000000000000000000000000000000000000000000815260040161097e9392919061146f565b60405180910390fd5b61099584848484035f610aae565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610a0c575f6040517f96c6fd1e000000000000000000000000000000000000000000000000000000008152600401610a0391906112ab565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610a7c575f6040517fec442f05000000000000000000000000000000000000000000000000000000008152600401610a7391906112ab565b60405180910390fd5b610a87838383610a9e565b505050565b610a998383836001610aae565b505050565b610aa9838383610c7d565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610b1e575f6040517fe602df05000000000000000000000000000000000000000000000000000000008152600401610b1591906112ab565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610b8e575f6040517f94280d62000000000000000000000000000000000000000000000000000000008152600401610b8591906112ab565b60405180910390fd5b8160015f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055508015610c77578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92584604051610c6e9190611037565b60405180910390a35b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610ccd578060025f828254610cc191906113ae565b92505081905550610d9b565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905081811015610d56578381836040517fe450d38c000000000000000000000000000000000000000000000000000000008152600401610d4d9392919061146f565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610de2578060025f8282540392505081905550610e2c565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610e899190611037565b60405180910390a3505050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f610ed882610e96565b610ee28185610ea0565b9350610ef2818560208601610eb0565b610efb81610ebe565b840191505092915050565b5f6020820190508181035f830152610f1e8184610ece565b905092915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610f5382610f2a565b9050919050565b610f6381610f49565b8114610f6d575f80fd5b50565b5f81359050610f7e81610f5a565b92915050565b5f819050919050565b610f9681610f84565b8114610fa0575f80fd5b50565b5f81359050610fb181610f8d565b92915050565b5f8060408385031215610fcd57610fcc610f26565b5b5f610fda85828601610f70565b9250506020610feb85828601610fa3565b9150509250929050565b5f8115159050919050565b61100981610ff5565b82525050565b5f6020820190506110225f830184611000565b92915050565b61103181610f84565b82525050565b5f60208201905061104a5f830184611028565b92915050565b5f805f6060848603121561106757611066610f26565b5b5f61107486828701610f70565b935050602061108586828701610f70565b925050604061109686828701610fa3565b9150509250925092565b5f60ff82169050919050565b6110b5816110a0565b82525050565b5f6020820190506110ce5f8301846110ac565b92915050565b5f602082840312156110e9576110e8610f26565b5b5f6110f684828501610f70565b91505092915050565b5f819050919050565b5f61112261111d61111884610f2a565b6110ff565b610f2a565b9050919050565b5f61113382611108565b9050919050565b5f61114482611129565b9050919050565b6111548161113a565b82525050565b5f60208201905061116d5f83018461114b565b92915050565b5f806040838503121561118957611188610f26565b5b5f61119685828601610f70565b92505060206111a785828601610f70565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f60028204905060018216806111f557607f821691505b602082108103611208576112076111b1565b5b50919050565b7f495354436f696e3a2044697265637420617070726f76652063616c6c732061725f8201527f652064697361626c656400000000000000000000000000000000000000000000602082015250565b5f611268602a83610ea0565b91506112738261120e565b604082019050919050565b5f6020820190508181035f8301526112958161125c565b9050919050565b6112a581610f49565b82525050565b5f6020820190506112be5f83018461129c565b92915050565b6112cd81610ff5565b81146112d7575f80fd5b50565b5f815190506112e8816112c4565b92915050565b5f6020828403121561130357611302610f26565b5b5f611310848285016112da565b91505092915050565b7f495354436f696e3a205370656e64657220697320626c61636b6c6973746564005f82015250565b5f61134d601f83610ea0565b915061135882611319565b602082019050919050565b5f6020820190508181035f83015261137a81611341565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6113b882610f84565b91506113c383610f84565b92508282019050808211156113db576113da611381565b5b92915050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f775f8201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b5f61143b602583610ea0565b9150611446826113e1565b604082019050919050565b5f6020820190508181035f8301526114688161142f565b9050919050565b5f6060820190506114825f83018661129c565b61148f6020830185611028565b61149c6040830184611028565b94935050505056fea26469706673582212201fbb789a33d8c8c22ea3db17719c70c7a24c39862058fc3328c8af580b23b02c64736f6c634300081a0033";

        // Streams
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        PrintStream printStream = new PrintStream(byteArrayOutputStream);
        StandardJsonTracer tracer = new StandardJsonTracer(printStream, true, true, true, true);

        // Start EVM
        EVMExecutor evmExecutor = EVMExecutor.evm(EvmSpecVersion.CANCUN);

        // Setup BlackList
        System.out.println("===================================== BLACKLIST DEPLOYMENT BEGINS HERE =====================================");
        BlackListExecution.SetupBlackList(evmExecutor, tracer, ownerAddress, blackListContractAddress, blockChain, blackListContractDeployCode, blackListContractRuntimeCode);
        System.out.println("===================================== BLACKLIST DEPLOYMENT ENDS HERE =====================================");
        System.out.println("\n===================================== BLACKLIST TEST BATTERY BEGINS HERE =====================================\n");
        BlackListExecution.RunBlackListTestBattery(evmExecutor, dudeGettingBlackListedAddress, byteArrayOutputStream, addToBlacklistFunctionSelector, removeFromBlacklistFunctionSelector, isBlackListedFunctionSelector);
        System.out.println("\n===================================== BLACKLIST TEST BATTERY ENDS HERE =====================================\n");

        // Setup ISTCoin
        System.out.println("===================================== ISTCOIN DEPLOYMENT BEGINS HERE =====================================");
        evmExecutor
                .code(Bytes.fromHexString(IstCoinContractDeployCode +
                        AuxFunctions.padHexStringTo256Bit(blackListContractAddress.toUnprefixedHexString()) +
                        AuxFunctions.padHexStringTo256Bit(ownerAddress.toUnprefixedHexString())))
                .sender(ownerAddress)
                .receiver(IstCoinAddress)
                .contract(IstCoinAddress)
                .messageFrameType(MessageFrame.Type.CONTRACT_CREATION)
                .worldUpdater(blockChain.updater())
                .commitWorldState();
        System.out.println("Contract code for ISTCoin loaded");

        evmExecutor.callData(Bytes.EMPTY);
        evmExecutor.execute();
        System.out.println("Constructor for ISTCoin ran");

        evmExecutor.code(Bytes.fromHexString(IstCoinContractRuntimeCode))
                .sender(ownerAddress)
                .receiver(IstCoinAddress)
                .messageFrameType(MessageFrame.Type.MESSAGE_CALL)
                .worldUpdater(blockChain.updater())
                .commitWorldState();
        System.out.println("Changed to runtimeCode for ISTCoin");
        System.out.println("===================================== ISTCOIN DEPLOYMENT ENDS HERE =====================================");
        System.out.println("\n===================================== ISTCOIN TEST BATTERY BEGINS HERE =====================================\n");
        // Check my balance
        evmExecutor.callData(Bytes.fromHexString(myBalanceFunctionSelector));
        evmExecutor.execute();
        System.out.println("Made call to check my own balance");
        BigInteger myBalance = AuxFunctions.extractBigIntegerFromReturnData(byteArrayOutputStream);
        System.out.println("Current balance is -> " + myBalance);
        // Transfer some money
        evmExecutor.callData(Bytes.fromHexString(transferFunctionSelector +
                AuxFunctions.padHexStringTo256Bit(ownerAddress.toUnprefixedHexString()) +
                AuxFunctions.padHexStringTo256Bit(randomDudeAddress.toUnprefixedHexString())+
                AuxFunctions.convertIntegerToHex256Bit(800)));
        evmExecutor.execute();
        System.out.println("\nMade call to transfer 800 coins to random dude");

        boolean callReturn = AuxFunctions.extractBooleanFromReturnData(byteArrayOutputStream);
        System.out.println("Transfer call returned -> " + callReturn+"\n");

        // Check my balance
        evmExecutor.callData(Bytes.fromHexString(myBalanceFunctionSelector));
        evmExecutor.execute();
        System.out.println("Made call to check my own balance");
        myBalance = AuxFunctions.extractBigIntegerFromReturnData(byteArrayOutputStream);
        System.out.println("Current balance is -> " + myBalance);
        System.out.println("\n===================================== ISTCOIN TEST BATTERY ENDS HERE =====================================\n");

    }

}